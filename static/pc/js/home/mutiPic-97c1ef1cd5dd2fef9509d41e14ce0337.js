define(["jquery","home/getRatioForView"],function(e,t){var n=function(){var t={},n={};return t.$container=null,t.animate=!1,t.currentZoom=null,t.$module=e('<div class="product-pic-section"> <ul class="container"> </ul> </div>'),t.imgZoom=function(e){if(t.animate)return;t.animate=!0;var n=400;if(t.$module.hasClass("scale-large")){e===undefined&&t.currentZoom&&(e=t.currentZoom);var r=t.$module.data("style");t.$module.attr("style",r),t.$module.removeClass("scale-large"),e.addClass("opcity0"),e.find("img").length===1&&(n=0),setTimeout(function(){var n,r=e.data("toggleimg");if(e.find("img").length===0)n=e[0].style.backgroundImage,e.data("toggleimg",n).css("background-image",r);else{var i={width:e.width(),height:e.height()},s=t.renderOneImg({width:e.data("imgwidth"),height:e.data("imgheight")},i);n=e.find("img")[0].src,e.data("toggleimg",n),e.find("img")[0].src=r,e.find("img").css({width:s.width,height:s.height,margin:-s.height/2+"px 0 0 -"+s.width/2+"px"})}e.attr("class",e.data("class")),t.animate=!1,t.currentZoom=null},n);return}if(e===undefined){t.animate=!1;return}t.currentZoom=e;var i=e.width(),s=e.height(),o=e.position().left,u=e.position().top,a=t.currentSize.width,f=t.currentSize.height,l=a/i,c=f/s,r=t.$module.attr("style"),h=e.attr("class");t.$module.data("style",r),e.data("class",h),t.$module.addClass("scale-large");var p=Math.ceil(a*l),d=f*c,v=o*l,m=u*c;t.$module.css({width:p,height:d,left:-v,top:-m}),e.addClass("opcity0"),e.find("img").length===1&&(n=0),setTimeout(function(){var n,r=e.data("toggleimg"),i={width:e.width(),height:e.height()},s=t.renderOneImg({width:e.data("bigimgwidth"),height:e.data("bigimgheight")},i),o=s.limitDirection==="width"?"limit-width":"limit-height";e.removeClass("limit-width").removeClass("limit-height").addClass(o),e.find("img").length===0?(n=e[0].style.backgroundImage,e.data("toggleimg",n).css("background-image",r)):(n=e.find("img")[0].src,e.data("toggleimg",n),e.find("img")[0].src=r,e.find("img").css({width:s.width,height:s.height,margin:-s.height/2+"px 0 0 -"+s.width/2+"px"})),e.removeClass("opcity0"),t.animate=!1},n)},t.renderHtml=function(n,r){if(!t.$container){console.log("[ERROR] need container for mutiPic");return}t.$container.append(t.$module),t.$module.height(r.height);if(n&&n.length){var i="";if(!r||r.width||r.height)r={width:e(window).width(),height:e(window).height()};t.currentSize=r;var o=[];o.width=0;var u=0,a;for(a=0,l=n.length;a<l;a++){var f={width:n[a].boxSize.substring(0,1),height:n[a].boxSize.substring(2,3)},c="w"+n[a].boxSize.replace("*"," h"),h={width:t.size["w"+f.width]*r.width,height:t.size["h"+f.height]*r.height};o[u+1]&&o[u+1]+t.size["h"+f.height]<=o[u]&&(u++,o.width+=t.size["w"+f.width]);var p={top:o[u]?o[u]:0,left:o.width};o[u]=p.top+t.size["h"+f.height],u++;if(f.width>1){var d;for(d=1,s=f.width;d<s;d++)o[u]=p.top+t.size["h"+f.height],u++}o.width+=t.size["w"+f.width],o.width>=1&&(u=0,o.width=0);var v=t.renderOneImg(n[a],h);if("backgroundSize"in e("<div></div>")[0].style){var m=v.limitDirection==="width"?"limit-width":"limit-height";i+='<li data-toggleimg="url('+n[a].bigImg+')" data-bigimgwidth="'+n[a].bigWidth+'" data-bigimgheight="'+n[a].bigHeight+'" data-imgwidth="'+n[a].width+'" data-imgheight="'+n[a].height+'" class="img-list '+c+" "+m+'" style="top:'+p.top*100+"%;left:"+p.left*100+"%;background-image:url("+n[a].url+');"></li>'}else i+='<li data-toggleimg="'+n[a].bigImg+'" class="img-list '+c+'" style="top:'+p.top*100+"%;left:"+p.left*100+'%;" data-bigimgwidth="'+n[a].bigWidth+'" data-bigimgheight="'+n[a].bigHeight+'" data-imgwidth="'+n[a].width+'" data-imgheight="'+n[a].height+'">',i+='<img src="'+n[a].url+'" style="height:'+v.height+"px; width:"+v.width+"px;margin:-"+v.height/2+"px 0 0 -"+v.width/2+'px;">',i+="</li>"}t.$module.find(".container").html(i)}},t.renderOneImg=function(e,t){var n=t.width,r=t.height,i=n/r,s=e.width/e.height,o="width",u,a;return i-s>0?(u=n,a=u/s):(a=r,o="height",u=r*s),{width:u,height:a,limitDirection:o}},t.handleEvent=function(){if(!t.$container){console.log("[ERROR] need container for mutiPic");return}t.$container.delegate(".img-list","click",function(){var n=e(this);t.imgZoom(n)})},t.reSize=function(){if("backgroundSize"in e("<div></div>")[0].style){var n=t.$module.find(".img-list");if(n.length){var r;for(r=0,l=n.length;r<l;r++){var i=e(n[r]),s={width:i.width(),height:i.height()},o=t.renderOneImg({width:i.data("imgwidth"),height:i.data("imgheight")},s),u=o.limitDirection==="width"?"limit-width":"limit-height";i.removeClass("limit-width").removeClass("limit-height").addClass(u)}}}else{var a=t.$module.find("img");if(a.length){var r;for(r=0,l=a.length;r<l;r++){var f=e(a[r]),s={width:f.parent().width(),height:f.parent().height()},o=t.renderOneImg({width:f.data("width"),height:f.data("height")},s);f.css({height:o.height,width:o.width,marginTop:-o.height/2,marginLeft:-o.width/2})}}}},n.render=function(e,n,r,i){t.size=i,typeof e=="object"&&e.length?(t.$container=r,t.$container.css({position:"relative",overflow:"hidden"}),t.renderHtml(e,n),t.handleEvent()):console.log("[ERROR FORM mutipic] imgs must be an array")},n.reSize=function(e){t.$module.height(e.height),t.currentSize=e,t.reSize()},n.scroll=function(){t.imgZoom()},n.render.apply(n,arguments),window.a=n.scroll,n};return n});